@using HoaLacLaptopShop.Areas.Administration.ViewModels
@using System.Collections.Generic
@using System.ComponentModel.DataAnnotations
@model GeneralStatsViewModel

<partial name="~/Areas/Administration/Views/Shared/_PageHeading.cshtml"
         model="@(new{ Heading = "Sales", Subheading = $"General"})" />

<form asp-action="Sales" method="get">
    <div class="form-group">
        <select class="form-control form-select" style="width: unset; display: inline-block" asp-for="TimeRange" asp-items="@(Html.GetEnumSelectList<TimeRange>())"></select>
        <select class="form-control form-select" style="width: unset; display: inline-block" asp-for="TimeSegment" asp-items="@(Html.GetEnumSelectList<TimeSegment>())"></select>
        <button class="btn btn-primary" type="submit"><i class="fa-solid fa-eye"></i> Show</button>
    </div>
</form>

<hr />


<h3>General Statistics</h3>

<div class="row">
    <div class="col-md-5">
        <div class="row">
            <div class="col-sm-6">
                <partial name="_SalesStatCard.cshtml" 
                    model="@(new 
                    {
                        Heading = "Units Sold",
                        Icon = "truck",
                        Value = Model.GeneralStats.UnitsSold
                    })" 
                />
                <partial name="_SalesStatCard.cshtml" 
                    model="@(new 
                    {
                        Heading = "Buyers",
                        Icon = "users",
                        Value = Model.GeneralStats.Customers
                    })" 
                />
                <partial name="_SalesStatCard.cshtml" 
                    model="@(new 
                    {
                        Heading = "Orders",
                        Icon = "shopping-cart",
                        Value = Model.GeneralStats.NumberOfOrders
                    })" 
                />
            </div>
            <div class="col-sm-6">
                <partial name="_SalesStatCard.cshtml" 
                    model="@(new 
                    {
                        Heading = "Total Revenue", 
                        Icon = "dollar-sign", 
                        Value = string.Format("{0:N0}", Model.GeneralStats.TotalRevenue) 
                    })" 
                />
                <partial name="_SalesStatCard.cshtml"
                    model="@(new
                    {
                        Heading = "Gross Sales",
                        Icon = "dollar-sign",
                        Value = string.Format("{0:N0}", Model.GeneralStats.GrossSales)
                    })" />
                <partial name="_SalesStatCard.cshtml" 
                    model="@(new 
                    {
                        Heading = "Discounts",
                        Icon = "percent",
                        Value =string.Format("{0:N0}", Model.GeneralStats.GrossSales - Model.GeneralStats.TotalRevenue)
                    })" 
                />
            </div>
        </div>
    </div>
    <div class="col-md-7">
        <div class="card flex-fill w-100">
            <div class="card-header">
                <h5 class="card-title mb-0">Sales: @(Model.TimeRange.GetAttribute<DisplayAttribute>().Name)</h5>
            </div>
            <div class="card-body d-flex w-100">
                <div class="align-self-center chart chart-lg">
                    <canvas id="chartjs-dashboard-bar"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<h3>Top Selling</h3>
<div class="row">
    <div class="col-md-8">
        <div class="card flex-fill">
            <div class="card-header">
                <h5 class="card-title mb-0">Top Selling Products</h5>
            </div>
            <table class="table my-0">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Units Sold</th>
                        <th>Gross Sales</th>
                        <th width="150"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.TopProducts)
                    {
                        <tr>
                            <td>
                                <div class="d-flex">
                                    <div class="flex-shrink-0">
                                        <div class="bg-light rounded-2">
                                            <img class="p-2"
                                                    src="@(item.Key.ProductImages.FirstOrDefault()?.GetProductImageURL())"
                                                    style="width: 40px; height: 40px">
                                        </div>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <strong>@item.Key.Name</strong>
                                        <div class="text-muted">@item.Key.Brand.Name</div>
                                    </div>
                                </div>
                            </td>
                            <td>@item.Value.UnitsSold</td>
                            <td>@item.Value.GrossSales.ToString("N0")</td>
                            <td>
                                <a asp-controller="Statistics" asp-action="Product" asp-route-id="@item.Key.ID" class="btn btn-primary fa-pull-right">
                                    <i class="fa-solid fa-eye"></i> View
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card flex-fill">
            <div class="card-header">
                <h5 class="card-title mb-0">Top Selling Brands</h5>
            </div>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Units Sold</th>
                        <th>Gross Sales</th>
                        <th width="150"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.TopBrands)
                    {
                        <tr>
                            <td><strong>@item.Key.Name</strong></td>
                            <td>@item.Value.UnitsSold</td>
                            <td>@item.Value.GrossSales.ToString("N0")</td>
                            <td>
                                <a asp-controller="Statistics" asp-action="Brand" asp-route-id="@item.Key.ID" class="btn btn-primary fa-pull-right">
                                    <i class="fa-solid fa-eye"></i> View
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts
{
    <partial name="~/Areas/Administration/Views/Statistics/_ChartInit.cshtml" model="@Model"></partial>
}
