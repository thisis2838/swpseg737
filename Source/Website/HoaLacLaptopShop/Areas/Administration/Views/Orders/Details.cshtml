@using HoaLacLaptopShop.Areas.Administration.ViewModels
@model Order

<style>
    .card-header {
        background-color: #f8f9fa;
    }

    .status-approved {
        color: #28a745;
        font-weight: bold;
    }

    .icon-circle {
        background-color: #f8f9fa;
        border-radius: 50%;
        padding: 10px;
        margin-right: 10px;
    }
    h5{
        margin-bottom: 0;
    }
</style>

<partial 
    name="~/Areas/Administration/Views/Shared/_PageHeading.cshtml" 
    model="@(new{ Heading = "Orders", Subheading = $"#({Model.ID})"})" 
/>
<a class="btn btn-primary" asp-action="Index">Back to List</a>
<hr/>

<div class="container mt-5">
    <!-- Order Information -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div>
                <h5>Order ID: #@Model.ID</h5>
                <p>@Model.OrderTime</p>
            </div>
            <div>
                <span class="status-approved">Approved</span>
            </div>
        </div>
    </div>

    <form asp-action="Update" method="post" id="orderForm">
        <input type="hidden" asp-for="ID" />
        <div class="row">
            <!-- Customer Information -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header d-flex align-items-center">
                        <i class="fas fa-user icon-circle"></i>
                        <h5>Recipient</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <strong><label asp-for="RecipientName"></label></strong>
                            <input class="form-control" asp-for="RecipientName" />
                            <span asp-validation-for="RecipientName"/>
                        </div>
                        <div class="form-group">
                            <strong><label asp-for="PhoneNumber"></label></strong>
                            <input class="form-control" asp-for="PhoneNumber" />
                            <span asp-validation-for="PhoneNumber" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header d-flex align-items-center">
                        <i class="fas fa-user icon-circle"></i>
                        <h5>Buyer</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <strong><label asp-for="Buyer.Name"></label></strong>
                            <input readonly class="form-control" asp-for="Buyer.Name" />
                        </div>
                        <div class="form-group">
                            <strong><label asp-for="Buyer.PhoneNumber"></label></strong>
                            <input readonly class="form-control" asp-for="Buyer.PhoneNumber" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <!-- Order Info -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header d-flex align-items-center">
                        <i class="fas fa-shopping-cart icon-circle"></i>
                        <h5>Location Info</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <strong><label asp-for="@Model.Province"></label></strong>
                            <select asp-for="@Model.Province" class="form-control" id="city">
                                <option value="@Model.Province" selected>@Model.Province</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <strong><label asp-for="@Model.District"></label></strong>
                            <select asp-for="@Model.District" class="form-control" id="district">
                                <option value="@Model.District" selected>@Model.District</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <strong><label asp-for="@Model.Ward"></label></strong>
                            <select asp-for="@Model.Ward" class="form-control" id="ward">
                                <option value="@Model.Ward" selected>@Model.Ward</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <strong><label asp-for="@Model.Street"></label></strong>
                            <input asp-for="@Model.Street" class="form-control" id="street"/>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Payment Information -->
           @*  <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header d-flex align-items-center">
                        <i class="fas fa-credit-card icon-circle"></i>
                        <h5>Payment Info</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            @if (Model.PaymentMethod == PaymentMethod.Online)
                            {
                                <label for="cardNumber"><strong>Master Card:</strong></label>
                                <input type="text" class="form-control" id="cardNumber" value="**** **** **** 8765" disabled>
                            }
                            @if (Model.PaymentMethod == PaymentMethod.CashOnDelivery)
                            {
                                <label for="cardNumber"><strong>Payment: </strong></label>
                                <input type="text" class="form-control" id="cardNumber" value="By Cash" disabled>
                            }
                        </div>
                        <div class="form-group">
                            <label for="businessName"><strong>Business name:</strong></label>
                            <input type="text" class="form-control" id="businessName" value="Maria Aniston" disabled>
                        </div>
                    </div>
                </div>
            </div> *@
        </div>

        <div class="row">
            <!-- Notes -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header d-flex align-items-center">
                        <i class="fas fa-sticky-note icon-circle"></i>
                        <h5>Notes</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label asp-for="Note">Type some note...</label>
                            <textarea class="form-control" asp-for="Note" rows="3">@Model.Note</textarea>
                        </div>
                        <button type="submit" class="btn btn-primary mt-2">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Products Table -->
    <div class="card mb-4">
        <div class="card-header">
            <h4>Products</h4>
        </div>
        <div class="card-body p-0">
            <table class="table mb-0">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Unit Price</th>
                        <th>Quantity</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach(var item in Model.OrderDetails)
                    {
                        <tr>
                            <td>@item.Product.Name</td>
                            <td>@item.Product.Price.ToString("C")</td>
                            <td>@item.Quantity</td>
                        </tr>
                    }
                   
                </tbody>
            </table>
        </div>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const provinceSelect = document.getElementById("city");
        const districtSelect = document.getElementById("district");
        const wardSelect = document.getElementById("ward");

        const model = {
            Province: "@Model.Province",
            District: "@Model.District",
            Ward: "@Model.Ward",
            Street: "@Model.Street"
        };

        function getProvinces() {
            fetch('https://esgoo.net/api-tinhthanh/1/0.htm')
                .then(response => response.json())
                .then(data_tinh => {
                    if (data_tinh.error === 0) {
                        const defaultOption = provinceSelect.querySelector(`option[value="${model.Province}"]`);
                        // provinceSelect.innerHTML = '';
                        console.log(defaultOption)

                        data_tinh.data.forEach(val_tinh => {
                            const option = document.createElement('option');
                            option.value = val_tinh.full_name;
                            option.innerHTML = val_tinh.full_name;
                            option.setAttribute('data-province-id', val_tinh.id);
                            provinceSelect.appendChild(option);
                        });
                        // Trigger change event to load districts for the default selected province
                        provinceSelect.dispatchEvent(new Event('change'));
                    }
                });
        }

        function getDistricts(provinceId) {
            fetch('https://esgoo.net/api-tinhthanh/2/' + provinceId + '.htm')
                .then(response => response.json())
                .then(data_quan => {
                    if (data_quan.error === 0) {
                        districtSelect.innerHTML = ''; // Clear previous options
                        data_quan.data.forEach(val_quan => {
                            const option = document.createElement('option');
                            option.value = val_quan.full_name;
                            option.innerHTML = val_quan.full_name;
                            option.setAttribute('data-district-id', val_quan.id);
                            districtSelect.appendChild(option);
                        });
                        // Trigger change event to load wards for the default selected district
                        districtSelect.dispatchEvent(new Event('change'));
                    }
                });
        }

        function getWards(districtId) {
            fetch('https://esgoo.net/api-tinhthanh/3/' + districtId + '.htm')
                .then(response => response.json())
                .then(data_quan => {
                    if (data_quan.error === 0) {
                        wardSelect.innerHTML = ''; // Clear previous options
                        data_quan.data.forEach(val_phuong => {
                            const option = document.createElement('option');
                            option.value = val_phuong.full_name;
                            option.innerHTML = val_phuong.full_name;
                            wardSelect.appendChild(option);
                        });
                        // Set the default selected ward
                        wardSelect.value = model.Ward;
                    }
                });
        }

        // Fetch provinces and set the initial selected province
        getProvinces();

        provinceSelect.addEventListener('change', e => {
            const selectedOption = e.target.options[e.target.selectedIndex];
            const provinceId = selectedOption.getAttribute('data-province-id');
            getDistricts(provinceId).then(() => {
                wardSelect.innerHTML = ''; // Clear wards when province changes
            });
        });

        districtSelect.addEventListener('change', e => {
            const selectedOption = e.target.options[e.target.selectedIndex];
            const districtId = selectedOption.getAttribute('data-district-id');
            getWards(districtId);
        });
    });


</script>